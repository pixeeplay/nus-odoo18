<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Dashboard Action (kanban-style with stats) -->
    <record id="action_pm_dashboard" model="ir.actions.act_window">
        <field name="name">Dashboard</field>
        <field name="res_model">pm.sync.log</field>
        <field name="view_mode">pivot,graph,list</field>
        <field name="context">{
            'search_default_group_operation': 1,
            'search_default_group_date': 1,
        }</field>
    </record>

    <!-- Dashboard overview as a form action on pm.config -->
    <record id="pm_dashboard_view_form" model="ir.ui.view">
        <field name="name">pm.config.dashboard</field>
        <field name="model">pm.config</field>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            <form string="Products Manager Dashboard" create="0" edit="0" delete="0">
                <div class="container-fluid o_pm_dashboard">
                    <!-- Stats Row -->
                    <div class="row mb-4">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Status</h5>
                                    <h2><field name="state" widget="badge"/></h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h5 class="card-title text-muted">API URL</h5>
                                    <field name="base_url" readonly="True"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h5 class="card-title text-muted">Last Sync</h5>
                                    <h4><field name="last_sync_date" readonly="True"/></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h5 class="card-title text-muted">Auto Sync</h5>
                                    <h4><field name="auto_sync" readonly="True"/> every <field name="sync_interval" readonly="True"/>h</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Actions Row -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex gap-2 flex-wrap">
                                <button name="action_open_search_wizard"
                                        string="Search &amp; Import"
                                        type="object"
                                        class="btn btn-primary btn-lg"
                                        icon="fa-search"/>
                                <button name="action_test_connection"
                                        string="Test Connection"
                                        type="object"
                                        class="btn btn-outline-primary btn-lg"
                                        icon="fa-plug"/>
                                <button name="action_sync_now"
                                        string="Sync Now"
                                        type="object"
                                        class="btn btn-outline-success btn-lg"
                                        icon="fa-refresh"/>
                            </div>
                        </div>
                    </div>
                </div>
                <field name="name" invisible="True"/>
            </form>
        </field>
    </record>

    <!-- Keep old act_window to avoid xmlid model conflict on upgrade -->
    <record id="action_pm_dashboard_config" model="ir.actions.act_window">
        <field name="name">Products Manager (legacy)</field>
        <field name="res_model">pm.config</field>
        <field name="view_mode">list,form</field>
    </record>

    <!-- Server action: opens dashboard if config exists, otherwise config form -->
    <record id="action_pm_open_dashboard" model="ir.actions.server">
        <field name="name">Products Manager Dashboard</field>
        <field name="model_id" ref="model_pm_config"/>
        <field name="state">code</field>
        <field name="code">action = model.action_open_dashboard()</field>
    </record>

</odoo>
