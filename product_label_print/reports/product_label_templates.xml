<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ============================================================ -->
    <!-- MAIN REPORT: 2 labels per A4, each = FRONT | BACK side by   -->
    <!-- side. User folds vertically to get recto-verso.              -->
    <!-- ============================================================ -->
    <template id="report_product_labels">
        <t t-call="web.html_container">
            <t t-call="product_label_print.label_styles"/>

            <t t-foreach="pages" t-as="page">
                <div class="label-page">
                    <t t-foreach="page" t-as="item">
                        <div class="label-row">
                            <!-- LEFT = FRONT -->
                            <t t-call="product_label_print.label_front">
                                <t t-set="item" t-value="item"/>
                            </t>
                            <!-- RIGHT = BACK -->
                            <t t-call="product_label_print.label_back">
                                <t t-set="item" t-value="item"/>
                            </t>
                        </div>
                    </t>
                    <!-- Fill empty row if odd number -->
                    <t t-if="len(page) == 1">
                        <div class="label-row label-row-empty"/>
                    </t>
                </div>
            </t>

        </t>
    </template>

    <!-- ============================================================ -->
    <!-- FRONT HALF (105mm x 148.5mm) - left side                    -->
    <!-- ============================================================ -->
    <template id="label_front">
        <div class="label-half label-front">
            <!-- HEADER: logo magasin | logo marque | energy -->
            <table class="lbl-header" cellpadding="0" cellspacing="0"><tr>
                <td class="lbl-header-store">
                    <img t-if="item.get('company_logo')"
                         t-att-src="item['company_logo']"
                         class="store-logo" alt="Store"/>
                </td>
                <td class="lbl-header-brand">
                    <img t-if="item.get('brand_logo')"
                         t-att-src="item['brand_logo']"
                         class="brand-logo" alt="Brand"/>
                    <span t-elif="item.get('brand_name')"
                          class="brand-name-txt"
                          t-esc="item['brand_name']"/>
                </td>
                <td class="lbl-header-energy">
                    <t t-if="show_energy_label and item.get('energy_label')">
                        <t t-call="product_label_print.energy_label_badge">
                            <t t-set="grade" t-value="item['energy_label']"/>
                        </t>
                    </t>
                </td>
            </tr></table>

            <!-- BODY: photo + nom + bullets -->
            <table class="lbl-body" cellpadding="0" cellspacing="0"><tr>
                <td class="lbl-photo">
                    <img t-if="item.get('product_image')"
                         t-att-src="item['product_image']"
                         class="product-img" alt="Product"/>
                    <div t-else="" class="no-photo-box">Pas d'image</div>
                </td>
                <td class="lbl-info">
                    <div class="product-name" t-esc="item['name']"/>
                    <div class="product-bullets" t-if="item.get('bullets')">
                        <t t-foreach="item['bullets']" t-as="bullet">
                            <div class="bullet-line">
                                <span class="bullet-dot">&#9679;</span>
                                <span t-esc="bullet"/>
                            </div>
                        </t>
                    </div>
                </td>
            </tr></table>

            <!-- META: categorie + reparabilite -->
            <table class="lbl-meta" cellpadding="0" cellspacing="0"><tr>
                <td>
                    <span class="categ-tag" t-if="item.get('categ_name')"
                          t-esc="item['categ_name']"/>
                </td>
                <td style="text-align:right;">
                    <t t-if="show_repairability and item.get('repairability_index', 0) &gt; 0">
                        <t t-call="product_label_print.repairability_badge">
                            <t t-set="score" t-value="item['repairability_index']"/>
                        </t>
                    </t>
                </td>
            </tr></table>

            <!-- PRICE BAR -->
            <table class="lbl-price-bar" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="price-left">
                        <t t-if="show_promo and item.get('promo_active') and item.get('promo_price', 0) &gt; 0">
                            <div class="price-old"><t t-esc="'%.2f' % item['list_price']"/> &#8364;</div>
                            <div class="price-promo"><t t-esc="'%.2f' % item['promo_price']"/> &#8364;</div>
                        </t>
                        <t t-else="">
                            <div class="price-normal"><t t-esc="'%.2f' % item['list_price']"/> &#8364;</div>
                        </t>
                    </td>
                    <td class="price-right">
                        <div class="price-deee"
                             t-if="show_deee and item.get('deee_amount', 0) &gt; 0">
                            Dont &#233;co-part.<br/>
                            <t t-esc="'%.2f' % item['deee_amount']"/> &#8364;
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </template>

    <!-- ============================================================ -->
    <!-- BACK HALF (105mm x 148.5mm) - right side                    -->
    <!-- ============================================================ -->
    <template id="label_back">
        <div class="label-half label-back">
            <div class="back-inner">
                <div class="back-name" t-esc="item['name']"/>
                <div class="back-ref" t-if="item.get('default_code')">
                    Réf : <t t-esc="item['default_code']"/>
                </div>
                <div class="back-barcode-box" t-if="item.get('barcode_uri')">
                    <img t-att-src="item['barcode_uri']"
                         class="barcode-img" alt="Barcode"/>
                </div>
                <div class="back-barcode-num" t-if="item.get('barcode')"
                     t-esc="item['barcode']"/>
                <div class="back-no-bc" t-if="not item.get('barcode')">
                    Pas de code-barres
                </div>
            </div>
        </div>
    </template>

    <!-- ============================================================ -->
    <!-- EU ENERGY LABEL BADGE                                        -->
    <!-- ============================================================ -->
    <template id="energy_label_badge">
        <div class="energy-badge">
            <t t-foreach="['A','B','C','D','E','F','G']" t-as="g">
                <div t-attf-class="energy-bar energy-{{g}} {{'energy-active' if g == grade else ''}}">
                    <span t-esc="g"/>
                </div>
            </t>
        </div>
    </template>

    <!-- ============================================================ -->
    <!-- REPAIRABILITY INDEX BADGE                                    -->
    <!-- ============================================================ -->
    <template id="repairability_badge">
        <div t-attf-class="repair-badge repair-color-{{'green' if score >= 8 else 'lightgreen' if score >= 6 else 'yellow' if score >= 4 else 'orange' if score >= 2 else 'red'}}">
            <span class="repair-val" t-esc="'%.1f' % score"/><span class="repair-of">/10</span>
        </div>
    </template>

    <!-- ============================================================ -->
    <!-- CSS                                                          -->
    <!-- ============================================================ -->
    <template id="label_styles">
        <style>
            /* ── PAGE ── */
            @page { margin: 0; size: A4 portrait; }
            .label-page {
                width: 210mm;
                height: 297mm;
                padding: 0;
                margin: 0;
                page-break-after: always;
            }

            /* ── ROW: 1 product = front + back side by side ── */
            .label-row {
                width: 210mm;
                height: 148.5mm;
                display: table;
                table-layout: fixed;
                border-bottom: 1px dashed #ccc;
            }
            .label-row-empty {
                width: 210mm;
                height: 148.5mm;
            }

            /* ── HALF: each 105mm x 148.5mm ── */
            .label-half {
                display: table-cell;
                width: 105mm;
                height: 148.5mm;
                vertical-align: top;
                padding: 4mm 5mm;
                overflow: hidden;
                font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
                font-size: 8pt;
                color: #333;
                box-sizing: border-box;
            }

            /* ── FRONT ── */
            .label-front {
                border-right: 1px dashed #ccc;
            }

            /* Header */
            .lbl-header {
                width: 100%;
                height: 14mm;
                border-bottom: 1.5px solid #0066cc;
                margin-bottom: 2mm;
            }
            .lbl-header td {
                vertical-align: middle;
            }
            .lbl-header-store { width: 28mm; }
            .lbl-header-brand { text-align: center; }
            .lbl-header-energy { width: 22mm; text-align: right; }
            .store-logo { max-height: 12mm; max-width: 26mm; }
            .brand-logo { max-height: 11mm; max-width: 35mm; }
            .brand-name-txt { font-size: 9pt; font-weight: bold; color: #555; }

            /* Body */
            .lbl-body {
                width: 100%;
                height: 72mm;
            }
            .lbl-photo {
                width: 38mm;
                vertical-align: middle;
                text-align: center;
                padding-right: 3mm;
            }
            .product-img {
                max-width: 36mm;
                max-height: 65mm;
            }
            .no-photo-box {
                width: 34mm;
                height: 34mm;
                background: #f5f5f5;
                border: 1px dashed #ddd;
                line-height: 34mm;
                text-align: center;
                color: #bbb;
                font-size: 7pt;
            }
            .lbl-info {
                vertical-align: top;
                padding-top: 1mm;
            }
            .product-name {
                font-size: 10pt;
                font-weight: bold;
                color: #222;
                line-height: 1.2;
                margin-bottom: 2mm;
                max-height: 14mm;
                overflow: hidden;
            }
            .product-bullets { }
            .bullet-line {
                font-size: 7.5pt;
                line-height: 1.4;
                color: #444;
                padding: 0.3mm 0;
            }
            .bullet-dot {
                color: #0066cc;
                font-size: 5pt;
                margin-right: 1mm;
                vertical-align: middle;
            }

            /* Meta */
            .lbl-meta {
                width: 100%;
                height: 8mm;
                margin-bottom: 1mm;
            }
            .lbl-meta td {
                vertical-align: middle;
            }
            .categ-tag {
                font-size: 6.5pt;
                color: #777;
                background: #f0f0f0;
                padding: 0.5mm 2mm;
                border-radius: 1mm;
                text-transform: uppercase;
                letter-spacing: 0.3pt;
            }

            /* Price bar */
            .lbl-price-bar {
                width: 100%;
                height: 16mm;
                background-color: #0055aa;
                color: #fff;
            }
            .lbl-price-bar td {
                vertical-align: middle;
                padding: 1mm 3mm;
            }
            .price-left { width: 65%; }
            .price-right { width: 35%; text-align: right; }
            .price-normal {
                font-size: 18pt;
                font-weight: 800;
                letter-spacing: -0.5pt;
                color: #fff;
            }
            .price-old {
                font-size: 10pt;
                text-decoration: line-through;
                color: #ccc;
            }
            .price-promo {
                font-size: 18pt;
                font-weight: 800;
                color: #ff4444;
            }
            .price-deee {
                font-size: 6pt;
                color: #ccc;
                line-height: 1.3;
            }

            /* ── BACK ── */
            .label-back {
                text-align: center;
            }
            .back-inner {
                padding-top: 20mm;
            }
            .back-name {
                font-size: 9pt;
                font-weight: bold;
                color: #333;
                margin-bottom: 2mm;
                max-height: 12mm;
                overflow: hidden;
            }
            .back-ref {
                font-size: 8pt;
                color: #777;
                margin-bottom: 6mm;
            }
            .back-barcode-box {
                margin: 4mm auto;
            }
            .barcode-img {
                width: 70mm;
                height: 22mm;
            }
            .back-barcode-num {
                font-family: 'Courier New', monospace;
                font-size: 10pt;
                letter-spacing: 1.5pt;
                color: #333;
                margin-top: 2mm;
            }
            .back-no-bc {
                font-size: 9pt;
                color: #bbb;
                border: 1.5px dashed #ddd;
                border-radius: 2mm;
                padding: 8mm 4mm;
                margin: 10mm 8mm;
            }

            /* ── ENERGY BADGE ── */
            .energy-badge {
                display: inline-block;
            }
            .energy-bar {
                height: 2mm;
                display: block;
                padding: 0 1mm;
                font-size: 5pt;
                font-weight: bold;
                color: #fff;
                line-height: 2mm;
                border-radius: 0 0.8mm 0.8mm 0;
                margin-bottom: 0.3mm;
            }
            .energy-A { width: 8mm; background: #00a651; }
            .energy-B { width: 10mm; background: #50b748; }
            .energy-C { width: 12mm; background: #bed630; }
            .energy-D { width: 14mm; background: #fff200; color: #333; }
            .energy-E { width: 16mm; background: #fcb813; }
            .energy-F { width: 18mm; background: #f15a22; }
            .energy-G { width: 20mm; background: #ed1c24; }
            .energy-active {
                height: 3mm;
                line-height: 3mm;
                font-size: 6.5pt;
                box-shadow: 0 0 0 0.4mm rgba(0,0,0,0.25);
                position: relative;
                z-index: 1;
            }

            /* ── REPAIRABILITY BADGE ── */
            .repair-badge {
                display: inline-block;
                padding: 0.5mm 3mm;
                border-radius: 1.5mm;
                font-weight: bold;
                text-align: center;
            }
            .repair-val { font-size: 9pt; }
            .repair-of { font-size: 6pt; opacity: 0.7; }
            .repair-color-green { background: #00a651; color: #fff; }
            .repair-color-lightgreen { background: #8cc63f; color: #fff; }
            .repair-color-yellow { background: #fff200; color: #333; }
            .repair-color-orange { background: #f7941d; color: #fff; }
            .repair-color-red { background: #ed1c24; color: #fff; }

            /* ── PRINT ── */
            @media print {
                .label-page { page-break-after: always; }
            }
        </style>
    </template>

</odoo>
